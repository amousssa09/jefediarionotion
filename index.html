<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Boss Battle - Combate √âpico</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #1a1a2e, #16213e, #0f3460);
            color: #fff;
            min-height: 100vh;
            overflow-x: hidden;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5rem;
            color: #ff6b6b;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
            margin-bottom: 10px;
        }

        .menu-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #ff6b6b;
            border: none;
            color: white;
            padding: 15px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.2rem;
            z-index: 1000;
            box-shadow: 0 4px 15px rgba(255, 107, 107, 0.4);
            transition: all 0.3s ease;
        }

        .menu-toggle:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(255, 107, 107, 0.6);
        }

        .dropdown-menu {
            position: fixed;
            top: 80px;
            right: 20px;
            background: rgba(26, 26, 46, 0.95);
            border-radius: 15px;
            padding: 20px;
            min-width: 350px;
            max-width: 400px;
            max-height: 80vh;
            overflow-y: auto;
            transform: translateY(-20px);
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 107, 107, 0.3);
            z-index: 999;
        }

        .dropdown-menu.active {
            transform: translateY(0);
            opacity: 1;
            visibility: visible;
        }

        .stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        .menu-tabs {
            display: flex;
            margin-bottom: 20px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            padding: 5px;
        }

        .tab-btn {
            flex: 1;
            background: transparent;
            border: none;
            color: #fff;
            padding: 10px 5px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }

        .tab-btn.active {
            background: #ff6b6b;
            color: white;
        }

        .tab-btn:hover:not(.active) {
            background: rgba(255, 255, 255, 0.1);
        }

        .config-section {
            margin-bottom: 25px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .config-section h3 {
            color: #4ecdc4;
            margin-bottom: 15px;
            font-size: 1.1rem;
        }

        .config-group {
            margin-bottom: 15px;
        }

        .config-group label {
            display: block;
            color: #fff;
            margin-bottom: 5px;
            font-size: 0.9rem;
        }

        .config-group input,
        .config-group select {
            width: 100%;
            padding: 8px 12px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            color: #fff;
            font-size: 0.9rem;
        }

        .config-group input:focus,
        .config-group select:focus {
            outline: none;
            border-color: #4ecdc4;
            box-shadow: 0 0 10px rgba(78, 205, 196, 0.3);
        }

        .config-group small {
            color: #aaa;
            font-size: 0.8rem;
            display: block;
            margin-top: 3px;
        }

        .config-btn {
            background: linear-gradient(135deg, #ff6b6b, #ff8e53);
            border: none;
            color: white;
            padding: 10px 20px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s ease;
            width: 100%;
            margin-top: 10px;
        }

        .config-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 107, 107, 0.4);
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .stat-card h3 {
            color: #4ecdc4;
            margin-bottom: 10px;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            color: #fff;
        }

        .battle-area {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 40px;
            margin-bottom: 30px;
            align-items: center;
        }

        .boss-section {
            text-align: center;
        }

        .boss-container {
            position: relative;
            margin-bottom: 20px;
        }

        .boss-image {
            width: 300px;
            height: 300px;
            border-radius: 20px;
            object-fit: cover;
            border: 3px solid #ff6b6b;
            box-shadow: 0 10px 30px rgba(255, 107, 107, 0.3);
            transition: all 0.3s ease;
        }

        .boss-image.attacking {
            animation: bossAttack 1s ease-in-out;
            filter: brightness(1.3) hue-rotate(30deg);
        }

        @keyframes bossAttack {
            0% { transform: scale(1) rotate(0deg); }
            25% { transform: scale(1.1) rotate(-5deg); }
            50% { transform: scale(1.15) rotate(5deg); }
            75% { transform: scale(1.1) rotate(-3deg); }
            100% { transform: scale(1) rotate(0deg); }
        }

        .health-bar {
            width: 100%;
            height: 20px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 10px;
        }

        .health-fill {
            height: 100%;
            background: linear-gradient(90deg, #ff6b6b, #ff8e53);
            transition: width 0.5s ease;
            border-radius: 10px;
        }

        .player-health-fill {
            background: linear-gradient(90deg, #4ecdc4, #44a08d);
        }

        .boss-info h2 {
            color: #ff6b6b;
            margin-bottom: 15px;
            font-size: 1.8rem;
        }

        .player-section {
            text-align: center;
        }

        .player-info h2 {
            color: #4ecdc4;
            margin-bottom: 15px;
            font-size: 1.8rem;
        }

        .attack-btn {
            background: linear-gradient(135deg, #4ecdc4, #44a08d);
            border: none;
            color: white;
            padding: 20px 40px;
            font-size: 1.2rem;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 20px rgba(78, 205, 196, 0.4);
            margin-top: 20px;
        }

        .attack-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(78, 205, 196, 0.6);
        }

        .attack-btn:active {
            transform: translateY(0);
        }

        .damage-indicator {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 2rem;
            font-weight: bold;
            color: #ff6b6b;
            opacity: 0;
            pointer-events: none;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
        }

        .damage-indicator.show {
            animation: damageFloat 1.5s ease-out;
        }

        @keyframes damageFloat {
            0% { opacity: 1; transform: translate(-50%, -50%) scale(0.8); }
            50% { opacity: 1; transform: translate(-50%, -70%) scale(1.2); }
            100% { opacity: 0; transform: translate(-50%, -90%) scale(1); }
        }

        .log {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 20px;
            max-height: 200px;
            overflow-y: auto;
            margin-bottom: 20px;
        }

        .log h3 {
            color: #4ecdc4;
            margin-bottom: 15px;
        }

        .log-entry {
            padding: 8px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            animation: fadeIn 0.5s ease;
        }

        .log-entry:last-child {
            border-bottom: none;
        }

        .log-entry.player-attack {
            color: #4ecdc4;
        }

        .log-entry.boss-attack {
            color: #ff6b6b;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .game-over {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .game-over.show {
            opacity: 1;
            visibility: visible;
        }

        .game-over-content {
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            border: 2px solid #ff6b6b;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.8);
        }

        .game-over h2 {
            font-size: 2.5rem;
            margin-bottom: 20px;
            color: #ff6b6b;
        }

        .restart-btn {
            background: linear-gradient(135deg, #ff6b6b, #ff8e53);
            border: none;
            color: white;
            padding: 15px 30px;
            font-size: 1.1rem;
            border-radius: 25px;
            cursor: pointer;
            margin-top: 20px;
            transition: all 0.3s ease;
        }

        .restart-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 107, 107, 0.5);
        }

        @media (max-width: 768px) {
            .battle-area {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .stats {
                grid-template-columns: 1fr;
            }
            
            .boss-image {
                width: 250px;
                height: 250px;
            }
            
            .header h1 {
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>‚öîÔ∏è BOSS BATTLE ‚öîÔ∏è</h1>
            <p>¬°Derrota al Drag√≥n Sombr√≠o!</p>
        </div>

        <button class="menu-toggle" onclick="toggleMenu()">‚ò∞</button>

        <div class="dropdown-menu" id="dropdownMenu">
            <div class="menu-tabs">
                <button class="tab-btn active" onclick="switchTab('stats')">üìä Estad√≠sticas</button>
                <button class="tab-btn" onclick="switchTab('config')">‚öôÔ∏è Configuraci√≥n</button>
                <button class="tab-btn" onclick="switchTab('log')">üìú Log</button>
            </div>

            <div class="tab-content" id="statsTab">
                <div class="stats">
                    <div class="stat-card">
                        <h3>Da√±o Total del Jefe</h3>
                        <div class="stat-value" id="totalBossDamage">0</div>
                    </div>
                    <div class="stat-card">
                        <h3>Da√±o Total del Jugador</h3>
                        <div class="stat-value" id="totalPlayerDamage">0</div>
                    </div>
                    <div class="stat-card">
                        <h3>EXP Actual</h3>
                        <div class="stat-value" id="currentExp">0</div>
                    </div>
                    <div class="stat-card">
                        <h3>Nivel</h3>
                        <div class="stat-value" id="playerLevel">1</div>
                    </div>
                </div>
            </div>

            <div class="tab-content" id="configTab" style="display: none;">
                <div class="config-section">
                    <h3>üêâ Configuraci√≥n del Jefe</h3>
                    <div class="config-group">
                        <label>HP del Jefe:</label>
                        <input type="number" id="bossMaxHp" value="1000" min="100" max="50000" onchange="updateBossStats()">
                    </div>
                    <div class="config-group">
                        <label>Da√±o M√≠nimo del Jefe:</label>
                        <input type="number" id="bossMinDamage" value="30" min="1" max="1000" onchange="updateBossStats()">
                    </div>
                    <div class="config-group">
                        <label>Da√±o M√°ximo del Jefe:</label>
                        <input type="number" id="bossMaxDamage" value="70" min="1" max="1000" onchange="updateBossStats()">
                    </div>
                </div>

                <div class="config-section">
                    <h3>üó°Ô∏è Configuraci√≥n del Jugador</h3>
                    <div class="config-group">
                        <label>Da√±o M√≠nimo del Jugador:</label>
                        <input type="number" id="playerMinDamage" value="40" min="1" max="1000" onchange="updatePlayerStats()">
                    </div>
                    <div class="config-group">
                        <label>Da√±o M√°ximo del Jugador:</label>
                        <input type="number" id="playerMaxDamage" value="100" min="1" max="1000" onchange="updatePlayerStats()">
                    </div>
                </div>

                <div class="config-section">
                    <h3>‚è∞ Configuraci√≥n de Ataques del Jefe</h3>
                    <div class="config-group">
                        <label>Modo de Ataque:</label>
                        <select id="attackMode" onchange="updateAttackMode()">
                            <option value="interval">Por Intervalo</option>
                            <option value="time">Por Horario Espec√≠fico</option>
                        </select>
                    </div>
                    
                    <div class="config-group" id="intervalConfig">
                        <label>Intervalo entre ataques:</label>
                        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; margin-bottom: 10px;">
                            <div>
                                <input type="number" id="intervalHours" value="0" min="0" max="23" placeholder="Horas" onchange="updateAttackSettings()">
                                <small style="text-align: center;">Horas</small>
                            </div>
                            <div>
                                <input type="number" id="intervalMinutes" value="0" min="0" max="59" placeholder="Minutos" onchange="updateAttackSettings()">
                                <small style="text-align: center;">Minutos</small>
                            </div>
                            <div>
                                <input type="number" id="intervalSeconds" value="5" min="1" max="59" placeholder="Segundos" onchange="updateAttackSettings()">
                                <small style="text-align: center;">Segundos</small>
                            </div>
                        </div>
                        <small>M√≠nimo: 1 segundo total</small>
                    </div>
                    
                    <div class="config-group" id="timeConfig" style="display: none;">
                        <label>Horas de ataque (separadas por comas):</label>
                        <input type="text" id="attackTimes" placeholder="09:00, 12:00, 18:00, 21:00" onchange="updateAttackSettings()">
                        <small>Formato: HH:MM (24 horas)</small>
                    </div>
                </div>

                <div class="config-section">
                    <h3>üéØ Configuraci√≥n de EXP</h3>
                    <div class="config-group">
                        <label>EXP por Victoria:</label>
                        <input type="number" id="winExp" value="100" min="0" max="10000" onchange="updateExpSettings()">
                    </div>
                    <div class="config-group">
                        <label>EXP perdida por Derrota:</label>
                        <input type="number" id="loseExp" value="50" min="0" max="10000" onchange="updateExpSettings()">
                    </div>
                </div>

                <div class="config-section">
                    <h3>üñºÔ∏è Personalizar Jefe</h3>
                    <div class="config-group">
                        <label>Nombre del Jefe:</label>
                        <input type="text" id="bossName" value="Drag√≥n Sombr√≠o" onchange="updateBossName()">
                    </div>
                    <div class="config-group">
                        <label>Imagen del Jefe:</label>
                        <input type="file" id="bossImageUpload" accept="image/*" onchange="uploadBossImage()">
                        <small>Formatos: JPG, PNG, GIF (m√°x. 5MB)</small>
                    </div>
                    <button class="config-btn" onclick="resetBossImage()">üîÑ Restaurar imagen original</button>
                </div>
            </div>

            <div class="tab-content" id="logTab" style="display: none;">
                <div class="log">
                    <h3>üìú Registro de Combate</h3>
                    <div id="combatLog"></div>
                </div>
            </div>
        </div>

        <div class="battle-area">
            <div class="boss-section">
                <div class="boss-info">
                    <h2>üêâ Drag√≥n Sombr√≠o</h2>
                    <div class="health-bar">
                        <div class="health-fill" id="bossHealth" style="width: 100%;"></div>
                    </div>
                    <p>HP: <span id="bossHpText">1000/1000</span></p>
                </div>
                <div class="boss-container">
                    <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 300 300'%3E%3Cdefs%3E%3CradialGradient id='dragonGrad' cx='50%25' cy='50%25' r='50%25'%3E%3Cstop offset='0%25' style='stop-color:%23ff4444;stop-opacity:1' /%3E%3Cstop offset='100%25' style='stop-color:%23990000;stop-opacity:1' /%3E%3C/radialGradient%3E%3C/defs%3E%3Cpath d='M150 50 L200 100 L180 140 L220 160 L200 200 L150 180 L100 200 L80 160 L120 140 L100 100 Z' fill='url(%23dragonGrad)' stroke='%23ff6600' stroke-width='3'/%3E%3Ccircle cx='130' cy='110' r='8' fill='%23ffff00'/%3E%3Ccircle cx='170' cy='110' r='8' fill='%23ffff00'/%3E%3Cpath d='M140 130 Q150 140 160 130' stroke='%23ffff00' stroke-width='3' fill='none'/%3E%3Cpath d='M100 80 Q80 60 70 80 Q80 70 100 80' fill='%23ff6600'/%3E%3Cpath d='M200 80 Q220 60 230 80 Q220 70 200 80' fill='%23ff6600'/%3E%3Cpath d='M150 220 L140 250 L160 250 Z' fill='%23ff4444'/%3E%3C/svg%3E" 
                         alt="Drag√≥n Sombr√≠o" class="boss-image" id="bossImage">
                    <div class="damage-indicator" id="bossDamageIndicator"></div>
                </div>
            </div>

            <div class="player-section">
                <div class="player-info">
                    <h2>üó°Ô∏è H√©roe Valiente</h2>
                    <div class="health-bar">
                        <div class="health-fill player-health-fill" id="playerHealth" style="width: 100%;"></div>
                    </div>
                    <p>HP: <span id="playerHpText">500/500</span></p>
                </div>
                <button class="attack-btn" id="attackBtn" onclick="playerAttack()">
                    ‚öîÔ∏è ATACAR
                </button>
                <div class="damage-indicator" id="playerDamageIndicator"></div>
            </div>
        </div>
    </div>

    <div class="game-over" id="gameOver">
        <div class="game-over-content">
            <h2 id="gameOverTitle">¬°Juego Terminado!</h2>
            <p id="gameOverMessage"></p>
            <button class="restart-btn" onclick="restartGame()">üîÑ Jugar de Nuevo</button>
        </div>
    </div>

    <script>
        // Estado del juego
        let gameState = {
            bossHp: 1000,
            bossMaxHp: 1000,
            playerHp: 500,
            playerMaxHp: 500,
            totalBossDamage: 0,
            totalPlayerDamage: 0,
            gameActive: true,
            lastBossAttack: Date.now(),
            experience: 0,
            level: 1,
            bossName: "Drag√≥n Sombr√≠o",
            originalBossImage: null
        };

        // Configuraci√≥n
        let gameConfig = {
            attackMode: 'interval', // 'interval' o 'time'
            attackIntervalHours: 0,
            attackIntervalMinutes: 0,
            attackIntervalSeconds: 5,
            attackTimes: [], // array de horas en formato "HH:MM"
            winExp: 100,
            loseExp: 50,
            bossMaxHp: 1000,
            bossMinDamage: 30,
            bossMaxDamage: 70,
            playerMinDamage: 40,
            playerMaxDamage: 100
        };

        // Ataques del jefe por d√≠a (simulamos con diferentes intervalos)
        const bossAttacks = [
            { name: "Aliento de Fuego", damage: [40, 60], interval: 5000, description: "¬°El drag√≥n escupe llamas ardientes!" },
            { name: "Garra Sombr√≠a", damage: [30, 50], interval: 4000, description: "¬°Garras afiladas rasgan el aire!" },
            { name: "Cola Devastadora", damage: [50, 70], interval: 6000, description: "¬°Un coletazo demoledor!" },
            { name: "Rugido Ensordecedor", damage: [20, 40], interval: 3000, description: "¬°Un rugido que aturde!" }
        ];

        let currentBossAttackIndex = 0;
        let bossAttackTimer;

        function initGame() {
            // Guardar imagen original del jefe
            gameState.originalBossImage = document.getElementById('bossImage').src;
            updateUI();
            startBossAttackCycle();
        }

        function updateUI() {
            // Actualizar barras de vida
            const bossHealthPercent = (gameState.bossHp / gameState.bossMaxHp) * 100;
            const playerHealthPercent = (gameState.playerHp / gameState.playerMaxHp) * 100;
            
            document.getElementById('bossHealth').style.width = bossHealthPercent + '%';
            document.getElementById('playerHealth').style.width = playerHealthPercent + '%';
            
            document.getElementById('bossHpText').textContent = `${gameState.bossHp}/${gameState.bossMaxHp}`;
            document.getElementById('playerHpText').textContent = `${gameState.playerHp}/${gameState.playerMaxHp}`;
            
            // Actualizar estad√≠sticas
            document.getElementById('totalBossDamage').textContent = gameState.totalBossDamage;
            document.getElementById('totalPlayerDamage').textContent = gameState.totalPlayerDamage;
            document.getElementById('currentExp').textContent = gameState.experience;
            document.getElementById('playerLevel').textContent = gameState.level;
            
            // Actualizar nombre del jefe
            document.querySelector('.boss-info h2').textContent = `üêâ ${gameState.bossName}`;
        }

        function playerAttack() {
            if (!gameState.gameActive) return;
            
            const damage = Math.floor(Math.random() * (gameConfig.playerMaxDamage - gameConfig.playerMinDamage + 1)) + gameConfig.playerMinDamage;
            gameState.bossHp = Math.max(0, gameState.bossHp - damage);
            gameState.totalPlayerDamage += damage;
            
            // Mostrar da√±o
            showDamageIndicator('bossDamageIndicator', damage, '#4ecdc4');
            
            // Agregar al log
            addToLog(`üó°Ô∏è Atacaste por ${damage} de da√±o (${gameConfig.playerMinDamage}-${gameConfig.playerMaxDamage})`, 'player-attack');
            
            updateUI();
            
            // Verificar si el jefe fue derrotado
            if (gameState.bossHp <= 0) {
                endGame(true);
            }
        }

        function bossAttack() {
            if (!gameState.gameActive) return;
            
            const attack = bossAttacks[currentBossAttackIndex];
            const damage = Math.floor(Math.random() * (gameConfig.bossMaxDamage - gameConfig.bossMinDamage + 1)) + gameConfig.bossMinDamage;
            
            gameState.playerHp = Math.max(0, gameState.playerHp - damage);
            gameState.totalBossDamage += damage;
            
            // Animaci√≥n de ataque del jefe
            const bossImage = document.getElementById('bossImage');
            bossImage.classList.add('attacking');
            setTimeout(() => bossImage.classList.remove('attacking'), 1000);
            
            // Mostrar da√±o
            showDamageIndicator('playerDamageIndicator', damage, '#ff6b6b');
            
            // Agregar al log
            addToLog(`üêâ ${attack.name}: ${attack.description} (${damage} da√±o)`, 'boss-attack');
            
            updateUI();
            
            // Verificar si el jugador fue derrotado
            if (gameState.playerHp <= 0) {
                endGame(false);
            }
            
            // Cambiar al siguiente ataque
            currentBossAttackIndex = (currentBossAttackIndex + 1) % bossAttacks.length;
        }

        function startBossAttackCycle() {
            if (!gameState.gameActive) return;
            
            clearTimeout(bossAttackTimer);
            
            if (gameConfig.attackMode === 'interval') {
                // Modo por intervalo - calcular tiempo total en milisegundos
                const totalMs = (gameConfig.attackIntervalHours * 3600 + 
                               gameConfig.attackIntervalMinutes * 60 + 
                               gameConfig.attackIntervalSeconds) * 1000;
                
                if (totalMs >= 1000) { // M√≠nimo 1 segundo
                    bossAttackTimer = setTimeout(() => {
                        bossAttack();
                        startBossAttackCycle();
                    }, totalMs);
                }
            } else {
                // Modo por horario espec√≠fico
                scheduleNextTimeAttack();
            }
        }

        function showDamageIndicator(elementId, damage, color) {
            const indicator = document.getElementById(elementId);
            indicator.textContent = `-${damage}`;
            indicator.style.color = color;
            indicator.classList.add('show');
            
            setTimeout(() => {
                indicator.classList.remove('show');
            }, 1500);
        }

        function addToLog(message, className) {
            const log = document.getElementById('combatLog');
            const entry = document.createElement('div');
            entry.className = `log-entry ${className}`;
            entry.textContent = `${new Date().toLocaleTimeString()}: ${message}`;
            
            log.appendChild(entry);
            log.scrollTop = log.scrollHeight;
            
            // Limitar el log a 20 entradas
            if (log.children.length > 20) {
                log.removeChild(log.firstChild);
            }
        }

        function endGame(playerWon) {
            gameState.gameActive = false;
            clearTimeout(bossAttackTimer);
            
            // Calcular cambio de EXP
            let expChange = 0;
            if (playerWon) {
                expChange = gameConfig.winExp;
                gameState.experience += expChange;
            } else {
                expChange = gameConfig.loseExp;
                gameState.experience = Math.max(0, gameState.experience - expChange);
            }
            
            // Calcular nuevo nivel (cada 100 EXP = 1 nivel)
            gameState.level = Math.floor(gameState.experience / 100) + 1;
            
            const gameOverElement = document.getElementById('gameOver');
            const titleElement = document.getElementById('gameOverTitle');
            const messageElement = document.getElementById('gameOverMessage');
            
            if (playerWon) {
                titleElement.textContent = 'üéâ ¬°VICTORIA! üéâ';
                titleElement.style.color = '#4ecdc4';
                messageElement.innerHTML = `
                    ¬°Has derrotado a ${gameState.bossName}!<br>
                    Da√±o total infligido: ${gameState.totalPlayerDamage}<br>
                    <span style="color: #4ecdc4;">+${expChange} EXP</span><br>
                    Nivel actual: ${gameState.level}
                `;
            } else {
                titleElement.textContent = 'üíÄ DERROTA üíÄ';
                titleElement.style.color = '#ff6b6b';
                messageElement.innerHTML = `
                    ${gameState.bossName} te ha derrotado.<br>
                    Da√±o total recibido: ${gameState.totalBossDamage}<br>
                    <span style="color: #ff6b6b;">-${expChange} EXP</span><br>
                    Nivel actual: ${gameState.level}
                `;
            }
            
            updateUI();
            gameOverElement.classList.add('show');
        }

        function restartGame() {
            // Reiniciar estado del juego (mantener EXP y nivel)
            const currentExp = gameState.experience;
            const currentLevel = gameState.level;
            const currentBossName = gameState.bossName;
            const currentBossImage = document.getElementById('bossImage').src;
            
            gameState = {
                bossHp: gameConfig.bossMaxHp,
                bossMaxHp: gameConfig.bossMaxHp,
                playerHp: 500,
                playerMaxHp: 500,
                totalBossDamage: 0,
                totalPlayerDamage: 0,
                gameActive: true,
                lastBossAttack: Date.now(),
                experience: currentExp,
                level: currentLevel,
                bossName: currentBossName,
                originalBossImage: gameState.originalBossImage
            };
            
            currentBossAttackIndex = 0;
            
            // Limpiar log
            document.getElementById('combatLog').innerHTML = '';
            
            // Ocultar pantalla de game over
            document.getElementById('gameOver').classList.remove('show');
            
            // Actualizar UI y reiniciar ciclo de ataques
            updateUI();
            startBossAttackCycle();
            
            addToLog('üîÑ ¬°Nueva batalla iniciada!', 'player-attack');
        }

        function toggleMenu() {
            const menu = document.getElementById('dropdownMenu');
            menu.classList.toggle('active');
        }

        // Cerrar men√∫ al hacer click fuera
        document.addEventListener('click', function(event) {
            const menu = document.getElementById('dropdownMenu');
            const toggle = document.querySelector('.menu-toggle');
            
            if (!menu.contains(event.target) && !toggle.contains(event.target)) {
                menu.classList.remove('active');
            }
        });

        // Funciones de configuraci√≥n
        function switchTab(tabName) {
            // Ocultar todas las pesta√±as
            document.getElementById('statsTab').style.display = 'none';
            document.getElementById('configTab').style.display = 'none';
            document.getElementById('logTab').style.display = 'none';
            
            // Remover clase active de todos los botones
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            
            // Mostrar pesta√±a seleccionada
            document.getElementById(tabName + 'Tab').style.display = 'block';
            document.querySelector(`[onclick="switchTab('${tabName}')"]`).classList.add('active');
        }

        function updateAttackMode() {
            const mode = document.getElementById('attackMode').value;
            gameConfig.attackMode = mode;
            
            if (mode === 'interval') {
                document.getElementById('intervalConfig').style.display = 'block';
                document.getElementById('timeConfig').style.display = 'none';
            } else {
                document.getElementById('intervalConfig').style.display = 'none';
                document.getElementById('timeConfig').style.display = 'block';
            }
            
            // Reiniciar el ciclo de ataques con la nueva configuraci√≥n
            if (gameState.gameActive) {
                startBossAttackCycle();
            }
        }

        function updateAttackSettings() {
            if (gameConfig.attackMode === 'interval') {
                gameConfig.attackIntervalHours = parseInt(document.getElementById('intervalHours').value) || 0;
                gameConfig.attackIntervalMinutes = parseInt(document.getElementById('intervalMinutes').value) || 0;
                gameConfig.attackIntervalSeconds = parseInt(document.getElementById('intervalSeconds').value) || 1;
                
                // Validar que el tiempo total sea al menos 1 segundo
                const totalSeconds = gameConfig.attackIntervalHours * 3600 + 
                                   gameConfig.attackIntervalMinutes * 60 + 
                                   gameConfig.attackIntervalSeconds;
                
                if (totalSeconds < 1) {
                    gameConfig.attackIntervalSeconds = 1;
                    document.getElementById('intervalSeconds').value = 1;
                    alert('El intervalo m√≠nimo debe ser de 1 segundo');
                }
                
                const hours = gameConfig.attackIntervalHours > 0 ? `${gameConfig.attackIntervalHours}h ` : '';
                const minutes = gameConfig.attackIntervalMinutes > 0 ? `${gameConfig.attackIntervalMinutes}m ` : '';
                const seconds = `${gameConfig.attackIntervalSeconds}s`;
                
                addToLog(`‚öôÔ∏è Intervalo actualizado: ${hours}${minutes}${seconds}`, 'player-attack');
            } else {
                const timesText = document.getElementById('attackTimes').value;
                gameConfig.attackTimes = timesText.split(',').map(time => time.trim()).filter(time => time);
                addToLog(`‚öôÔ∏è Horarios configurados: ${gameConfig.attackTimes.join(', ')}`, 'player-attack');
            }
            
            // Reiniciar el ciclo de ataques con la nueva configuraci√≥n
            if (gameState.gameActive) {
                startBossAttackCycle();
            }
        }

        function updateBossStats() {
            const newMaxHp = parseInt(document.getElementById('bossMaxHp').value) || 1000;
            const newMinDamage = parseInt(document.getElementById('bossMinDamage').value) || 30;
            const newMaxDamage = parseInt(document.getElementById('bossMaxDamage').value) || 70;
            
            // Validar que el da√±o m√≠nimo no sea mayor que el m√°ximo
            if (newMinDamage > newMaxDamage) {
                document.getElementById('bossMaxDamage').value = newMinDamage;
                gameConfig.bossMaxDamage = newMinDamage;
            } else {
                gameConfig.bossMaxDamage = newMaxDamage;
            }
            
            gameConfig.bossMaxHp = newMaxHp;
            gameConfig.bossMinDamage = newMinDamage;
            
            // Si el jefe ya existe, actualizar su HP m√°xima y actual proporcionalmente
            if (gameState.bossMaxHp !== newMaxHp) {
                const hpPercent = gameState.bossHp / gameState.bossMaxHp;
                gameState.bossMaxHp = newMaxHp;
                gameState.bossHp = Math.floor(newMaxHp * hpPercent);
                updateUI();
            }
            
            addToLog(`‚öôÔ∏è Stats del jefe actualizados - HP: ${newMaxHp}, Da√±o: ${newMinDamage}-${gameConfig.bossMaxDamage}`, 'player-attack');
        }

        function updatePlayerStats() {
            const newMinDamage = parseInt(document.getElementById('playerMinDamage').value) || 40;
            const newMaxDamage = parseInt(document.getElementById('playerMaxDamage').value) || 100;
            
            // Validar que el da√±o m√≠nimo no sea mayor que el m√°ximo
            if (newMinDamage > newMaxDamage) {
                document.getElementById('playerMaxDamage').value = newMinDamage;
                gameConfig.playerMaxDamage = newMinDamage;
            } else {
                gameConfig.playerMaxDamage = newMaxDamage;
            }
            
            gameConfig.playerMinDamage = newMinDamage;
            
            addToLog(`‚öôÔ∏è Stats del jugador actualizados - Da√±o: ${newMinDamage}-${gameConfig.playerMaxDamage}`, 'player-attack');
        }

        function updateExpSettings() {
            gameConfig.winExp = parseInt(document.getElementById('winExp').value) || 100;
            gameConfig.loseExp = parseInt(document.getElementById('loseExp').value) || 50;
            addToLog('‚öôÔ∏è Configuraci√≥n de EXP actualizada', 'player-attack');
        }

        function updateBossName() {
            gameState.bossName = document.getElementById('bossName').value || 'Drag√≥n Sombr√≠o';
            updateUI();
            addToLog(`‚öôÔ∏è Jefe renombrado a: ${gameState.bossName}`, 'player-attack');
        }

        function uploadBossImage() {
            const fileInput = document.getElementById('bossImageUpload');
            const file = fileInput.files[0];
            
            if (!file) return;
            
            // Validar tama√±o (m√°x 5MB)
            if (file.size > 5 * 1024 * 1024) {
                alert('La imagen es demasiado grande. M√°ximo 5MB.');
                return;
            }
            
            // Validar tipo
            if (!file.type.startsWith('image/')) {
                alert('Por favor selecciona un archivo de imagen v√°lido.');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                const bossImage = document.getElementById('bossImage');
                bossImage.src = e.target.result;
                addToLog('üñºÔ∏è Imagen del jefe actualizada', 'player-attack');
            };
            reader.readAsDataURL(file);
        }

        function resetBossImage() {
            if (gameState.originalBossImage) {
                document.getElementById('bossImage').src = gameState.originalBossImage;
                addToLog('üîÑ Imagen del jefe restaurada', 'player-attack');
            }
        }

        function scheduleNextTimeAttack() {
            if (!gameState.gameActive || gameConfig.attackTimes.length === 0) return;
            
            const now = new Date();
            const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
            
            let nextAttackTime = null;
            
            // Buscar la pr√≥xima hora de ataque hoy
            for (const timeStr of gameConfig.attackTimes) {
                const [hours, minutes] = timeStr.split(':').map(num => parseInt(num));
                if (isNaN(hours) || isNaN(minutes)) continue;
                
                const attackTime = new Date(today);
                attackTime.setHours(hours, minutes, 0, 0);
                
                if (attackTime > now) {
                    if (!nextAttackTime || attackTime < nextAttackTime) {
                        nextAttackTime = attackTime;
                    }
                }
            }
            
            // Si no hay m√°s ataques hoy, programar para ma√±ana
            if (!nextAttackTime && gameConfig.attackTimes.length > 0) {
                const tomorrow = new Date(today);
                tomorrow.setDate(tomorrow.getDate() + 1);
                
                const firstTimeStr = gameConfig.attackTimes[0];
                const [hours, minutes] = firstTimeStr.split(':').map(num => parseInt(num));
                if (!isNaN(hours) && !isNaN(minutes)) {
                    nextAttackTime = new Date(tomorrow);
                    nextAttackTime.setHours(hours, minutes, 0, 0);
                }
            }
            
            if (nextAttackTime) {
                const delay = nextAttackTime.getTime() - now.getTime();
                bossAttackTimer = setTimeout(() => {
                    bossAttack();
                    scheduleNextTimeAttack();
                }, delay);
                
                addToLog(`‚è∞ Pr√≥ximo ataque programado: ${nextAttackTime.toLocaleTimeString()}`, 'boss-attack');
            }
        }

        // Inicializar el juego
        initGame();
        addToLog('‚öîÔ∏è ¬°La batalla ha comenzado!', 'player-attack');
    </script>
</body>
</html>
